<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2a1745;
            background-image:
                url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"),
                radial-gradient(ellipse at center, #3d2066 0%, #2a1745 50%, #1a0f2e 100%);
            background-blend-mode: overlay, normal;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            color: #e8d5f7;
        }
        .game-container {
            width: 100%;
            max-width: 800px;
        }
        .info-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(75, 45, 110, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #9b6dd1;
        }
        .info-item {
            text-align: center;
        }
        .info-label {
            font-size: 0.85rem;
            color: #c9b0e8;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f0e6ff;
        }
        .table {
            background-color: #4a2c7a;
            background-image:
                url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='felt'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23felt)'/%3E%3C/svg%3E");
            background-blend-mode: soft-light;
            border-radius: 20px;
            padding: 30px;
            border: 12px solid #5c3d1e;
            box-shadow:
                inset 0 0 50px rgba(0,0,0,0.3),
                0 10px 30px rgba(0,0,0,0.5),
                0 0 0 4px #8b6914,
                0 0 0 8px #5c3d1e;
        }
        .hand {
            min-height: 140px;
            margin-bottom: 20px;
        }
        .hand-label {
            font-size: 1.1rem;
            color: #c9b0e8;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hand-value {
            background: #6b3fa0;
            padding: 3px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        .cards {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .card {
            width: 70px;
            height: 100px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            position: relative;
        }
        .card.red {
            color: #c41e3a;
        }
        .card.black {
            color: #1a1a2e;
        }
        .card.hidden {
            background: linear-gradient(135deg, #5c3d8c 0%, #3d2066 100%);
            border: 2px solid #9b6dd1;
        }
        .card.hidden::after {
            content: "?";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #c9b0e8;
        }
        .card-corner {
            line-height: 1;
        }
        .card-corner.bottom {
            align-self: flex-end;
            transform: rotate(180deg);
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-primary {
            background: linear-gradient(135deg, #9b6dd1 0%, #7b4db8 100%);
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #ab7de1 0%, #8b5dc8 100%);
            transform: translateY(-2px);
        }
        .btn-danger {
            background: linear-gradient(135deg, #c41e3a 0%, #8b1528 100%);
            color: white;
        }
        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #d42e4a 0%, #9b2538 100%);
            transform: translateY(-2px);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
        }
        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, #38b755 0%, #2e8e44 100%);
            transform: translateY(-2px);
        }
        .betting-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .bet-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bet-input label {
            color: #c9b0e8;
        }
        .bet-input input {
            width: 100px;
            padding: 10px;
            font-size: 1.1rem;
            border: 2px solid #7b4db8;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            text-align: center;
        }
        .bet-input input:focus {
            outline: none;
            border-color: #9b6dd1;
        }
        .chip-buttons {
            display: flex;
            gap: 8px;
        }
        .chip {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px dashed rgba(255,255,255,0.5);
            font-weight: bold;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .chip:hover {
            transform: scale(1.1);
        }
        .chip-5 { background: #c41e3a; color: white; }
        .chip-10 { background: #2563eb; color: white; }
        .chip-25 { background: #16a34a; color: white; }
        .chip-100 { background: #1a1a2e; color: white; }
        .message {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px;
            margin-top: 20px;
            border-radius: 10px;
            display: none;
        }
        .message.show {
            display: block;
        }
        .message.win {
            background: rgba(40, 167, 69, 0.3);
            border: 2px solid #28a745;
            color: #7dff9d;
        }
        .message.lose {
            background: rgba(196, 30, 58, 0.3);
            border: 2px solid #c41e3a;
            color: #ff8a9d;
        }
        .message.push {
            background: rgba(155, 109, 209, 0.3);
            border: 2px solid #9b6dd1;
            color: #e8d5f7;
        }
        .message.blackjack {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3) 0%, rgba(255, 165, 0, 0.3) 100%);
            border: 2px solid #ffd700;
            color: #ffd700;
        }
        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #7b4db8, transparent);
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>♠ Blackjack ♥</h1>

    <div class="game-container">
        <div class="info-bar">
            <div class="info-item">
                <div class="info-label">Bankroll</div>
                <div class="info-value">$<span id="bankroll">1000</span></div>
            </div>
            <div class="info-item">
                <div class="info-label">Current Bet</div>
                <div class="info-value">$<span id="current-bet">0</span></div>
            </div>
            <div class="info-item">
                <div class="info-label">Wins / Losses</div>
                <div class="info-value"><span id="wins">0</span> / <span id="losses">0</span></div>
            </div>
        </div>

        <div class="table">
            <div class="hand">
                <div class="hand-label">
                    Dealer's Hand
                    <span class="hand-value" id="dealer-value">0</span>
                </div>
                <div class="cards" id="dealer-cards"></div>
            </div>

            <div class="divider"></div>

            <div class="hand">
                <div class="hand-label">
                    Your Hand
                    <span class="hand-value" id="player-value">0</span>
                </div>
                <div class="cards" id="player-cards"></div>
            </div>

            <div class="message" id="message"></div>

            <div class="betting-controls" id="betting-controls">
                <div class="bet-input">
                    <label>Bet: $</label>
                    <input type="number" id="bet-amount" value="10" min="5" max="500">
                </div>
                <div class="chip-buttons">
                    <button class="chip chip-5" onclick="addToBet(5)">$5</button>
                    <button class="chip chip-10" onclick="addToBet(10)">$10</button>
                    <button class="chip chip-25" onclick="addToBet(25)">$25</button>
                    <button class="chip chip-100" onclick="addToBet(100)">$100</button>
                </div>
                <button class="btn-primary" onclick="startGame()">Deal</button>
            </div>

            <div class="controls" id="game-controls" style="display: none;">
                <button class="btn-primary" id="hit-btn" onclick="hit()">Hit</button>
                <button class="btn-success" id="stand-btn" onclick="stand()">Stand</button>
            </div>

            <div class="controls" id="end-controls" style="display: none;">
                <button class="btn-primary" onclick="newRound()">New Hand</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let deck = [];
        let playerHand = [];
        let dealerHand = [];
        let bankroll = 1000;
        let currentBet = 0;
        let wins = 0;
        let losses = 0;
        let gameInProgress = false;

        // Card suits and ranks
        const suits = ['♠', '♥', '♦', '♣'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

        // Create a fresh deck
        function createDeck() {
            deck = [];
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push({ suit, rank });
                }
            }
            // Verify deck has 52 cards
            if (deck.length !== 52) {
                console.error('Deck creation error: Expected 52 cards, got ' + deck.length);
            }
        }

        // Fisher-Yates shuffle
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        // Get card value
        function getCardValue(card) {
            if (['J', 'Q', 'K'].includes(card.rank)) return 10;
            if (card.rank === 'A') return 11;
            return parseInt(card.rank);
        }

        // Calculate hand value with Ace handling
        function calculateHandValue(hand) {
            let value = 0;
            let aces = 0;

            for (let card of hand) {
                value += getCardValue(card);
                if (card.rank === 'A') aces++;
            }

            // Convert Aces from 11 to 1 if needed
            while (value > 21 && aces > 0) {
                value -= 10;
                aces--;
            }

            return value;
        }

        // Check if hand is a Blackjack (natural 21 with 2 cards)
        function isBlackjack(hand) {
            return hand.length === 2 && calculateHandValue(hand) === 21;
        }

        // Deal a card
        function dealCard() {
            if (deck.length === 0) {
                createDeck();
                shuffleDeck();
            }
            return deck.pop();
        }

        // Render a card
        function renderCard(card, hidden = false) {
            if (hidden) {
                return '<div class="card hidden"></div>';
            }
            const isRed = card.suit === '♥' || card.suit === '♦';
            const colorClass = isRed ? 'red' : 'black';
            return `
                <div class="card ${colorClass}">
                    <div class="card-corner">${card.rank}${card.suit}</div>
                    <div class="card-corner bottom">${card.rank}${card.suit}</div>
                </div>
            `;
        }

        // Update the display
        function updateDisplay(hideDealer = true) {
            // Render dealer cards
            const dealerCardsEl = document.getElementById('dealer-cards');
            let dealerHTML = '';
            dealerHand.forEach((card, index) => {
                if (hideDealer && index === 1) {
                    dealerHTML += renderCard(card, true);
                } else {
                    dealerHTML += renderCard(card);
                }
            });
            dealerCardsEl.innerHTML = dealerHTML;

            // Render player cards
            const playerCardsEl = document.getElementById('player-cards');
            playerCardsEl.innerHTML = playerHand.map(card => renderCard(card)).join('');

            // Update values
            const playerValue = calculateHandValue(playerHand);
            const dealerValue = hideDealer ? getCardValue(dealerHand[0]) : calculateHandValue(dealerHand);

            document.getElementById('player-value').textContent = playerValue;
            document.getElementById('dealer-value').textContent = hideDealer ? dealerValue + ' + ?' : dealerValue;

            // Update info bar
            document.getElementById('bankroll').textContent = bankroll;
            document.getElementById('current-bet').textContent = currentBet;
            document.getElementById('wins').textContent = wins;
            document.getElementById('losses').textContent = losses;
        }

        // Show message
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = 'message show ' + type;
        }

        // Hide message
        function hideMessage() {
            document.getElementById('message').className = 'message';
        }

        // Add to bet
        function addToBet(amount) {
            const betInput = document.getElementById('bet-amount');
            let currentValue = parseInt(betInput.value) || 0;
            betInput.value = Math.min(currentValue + amount, bankroll);
        }

        // Start a new game
        function startGame() {
            const betAmount = parseInt(document.getElementById('bet-amount').value);

            if (betAmount < 5) {
                alert('Minimum bet is $5');
                return;
            }
            if (betAmount > bankroll) {
                alert('You don\'t have enough money for that bet!');
                return;
            }

            currentBet = betAmount;
            bankroll -= currentBet;
            gameInProgress = true;

            // Create and shuffle deck
            createDeck();
            shuffleDeck();

            // Deal initial cards
            playerHand = [dealCard(), dealCard()];
            dealerHand = [dealCard(), dealCard()];

            hideMessage();
            updateDisplay(true);

            // Show/hide controls
            document.getElementById('betting-controls').style.display = 'none';
            document.getElementById('game-controls').style.display = 'flex';
            document.getElementById('end-controls').style.display = 'none';

            // Check for immediate blackjacks
            const playerBJ = isBlackjack(playerHand);
            const dealerBJ = isBlackjack(dealerHand);

            if (playerBJ || dealerBJ) {
                // Reveal dealer's hand
                updateDisplay(false);
                endGame(playerBJ, dealerBJ);
            }
        }

        // Player hits
        function hit() {
            playerHand.push(dealCard());
            updateDisplay(true);

            const playerValue = calculateHandValue(playerHand);
            if (playerValue > 21) {
                // Player busts
                updateDisplay(false);
                losses++;
                showMessage('Bust! You lose $' + currentBet, 'lose');
                endRound();
            } else if (playerValue === 21) {
                // Auto-stand on 21
                stand();
            }
        }

        // Player stands
        function stand() {
            // Disable buttons
            document.getElementById('hit-btn').disabled = true;
            document.getElementById('stand-btn').disabled = true;

            // Reveal dealer's hole card
            updateDisplay(false);

            // Dealer draws
            dealerPlay();
        }

        // Dealer's turn
        function dealerPlay() {
            let dealerValue = calculateHandValue(dealerHand);

            // Dealer hits on 16 or less
            while (dealerValue < 17) {
                dealerHand.push(dealCard());
                dealerValue = calculateHandValue(dealerHand);
                updateDisplay(false);
            }

            // Determine winner
            determineWinner();
        }

        // End game for blackjack scenarios
        function endGame(playerBJ, dealerBJ) {
            if (playerBJ && dealerBJ) {
                // Both have blackjack - Push
                bankroll += currentBet;
                showMessage('Both have Blackjack! Push - Bet returned', 'push');
            } else if (playerBJ) {
                // Player has blackjack - 3:2 payout
                const winnings = Math.floor(currentBet * 2.5);
                bankroll += winnings;
                wins++;
                showMessage('Blackjack! You win $' + (winnings - currentBet) + '!', 'blackjack');
            } else if (dealerBJ) {
                // Dealer has blackjack
                losses++;
                showMessage('Dealer has Blackjack! You lose $' + currentBet, 'lose');
            }
            endRound();
        }

        // Determine the winner
        function determineWinner() {
            const playerValue = calculateHandValue(playerHand);
            const dealerValue = calculateHandValue(dealerHand);

            if (dealerValue > 21) {
                // Dealer busts
                bankroll += currentBet * 2;
                wins++;
                showMessage('Dealer busts! You win $' + currentBet + '!', 'win');
            } else if (playerValue > dealerValue) {
                // Player wins
                bankroll += currentBet * 2;
                wins++;
                showMessage('You win $' + currentBet + '!', 'win');
            } else if (dealerValue > playerValue) {
                // Dealer wins
                losses++;
                showMessage('Dealer wins. You lose $' + currentBet, 'lose');
            } else {
                // Push
                bankroll += currentBet;
                showMessage('Push! Bet returned', 'push');
            }

            endRound();
        }

        // End the round
        function endRound() {
            gameInProgress = false;
            document.getElementById('game-controls').style.display = 'none';
            document.getElementById('end-controls').style.display = 'flex';
            updateDisplay(false);

            // Check if player is out of money
            if (bankroll < 5) {
                setTimeout(() => {
                    if (confirm('You\'re out of money! Would you like to start over with $1000?')) {
                        bankroll = 1000;
                        wins = 0;
                        losses = 0;
                        updateDisplay(false);
                    }
                }, 1000);
            }
        }

        // Start a new round
        function newRound() {
            playerHand = [];
            dealerHand = [];
            currentBet = 0;

            hideMessage();
            updateDisplay(false);

            document.getElementById('betting-controls').style.display = 'flex';
            document.getElementById('game-controls').style.display = 'none';
            document.getElementById('end-controls').style.display = 'none';

            // Re-enable buttons
            document.getElementById('hit-btn').disabled = false;
            document.getElementById('stand-btn').disabled = false;

            // Reset displayed values
            document.getElementById('player-value').textContent = '0';
            document.getElementById('dealer-value').textContent = '0';
            document.getElementById('player-cards').innerHTML = '';
            document.getElementById('dealer-cards').innerHTML = '';
        }

        // Initialize
        updateDisplay(false);
    </script>
</body>
</html>
